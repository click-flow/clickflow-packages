FROM node:14-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
	AWS_API_VERSION=2015-03-31 \
	AWS_REGION=$AWS_REGION \
	AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
	CLOUDEVENT_STREAM_ID=$CLOUDEVENT_STREAM_ID \
	CLOUDEVENT_STREAM_MECHANISM=$CLOUDEVENT_STREAM_MECHANISM \
	CLOUDEVENT_STREAM_PASSWORD=$CLOUDEVENT_STREAM_PASSWORD \
	CLOUDEVENT_STREAM_PROTOCOL=$CLOUDEVENT_STREAM_PROTOCOL \
	CLOUDEVENT_STREAM_URLS=$CLOUDEVENT_STREAM_URLS \
	CLOUDEVENT_STREAM_USERNAME=$CLOUDEVENT_STREAM_USERNAME \
	FUNCTION_MAPS=$FUNCTION_MAPS \
	FUNCTION_MAPS_FILE=$FUNCTION_MAPS_FILE \
	HOST=0.0.0.0 \
	NODE_ENV=production

CMD [ "node", "index.js" ]
